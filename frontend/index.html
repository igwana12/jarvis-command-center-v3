<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarvis Command Center V5 - Complete Resource Control</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00D4FF;
            --secondary: #FF00D4;
            --background: #0A0E27;
            --surface: #1A1E37;
            --surface-light: #2A2E47;
            --text: #E0E0E0;
            --text-dim: #A0A0A0;
            --success: #00FF88;
            --warning: #FFD700;
            --danger: #FF4444;
        }

        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            background: linear-gradient(135deg, #0A0E27 0%, #1A0E27 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: var(--surface);
            border-radius: 15px;
            border: 1px solid var(--primary);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--text-dim);
            font-size: 1.2em;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
            padding: 10px 20px;
            background: var(--surface-light);
            border-radius: 10px;
            border: 1px solid var(--primary);
        }

        .stat-value {
            font-size: 2em;
            color: var(--primary);
            font-weight: bold;
        }

        .stat-label {
            color: var(--text-dim);
            margin-top: 5px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--surface), var(--surface-light));
            border: 1px solid var(--primary);
            color: var(--primary);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            font-size: 1em;
        }

        .control-btn:hover {
            background: var(--primary);
            color: var(--background);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4);
        }

        .resource-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .resource-category {
            background: var(--surface);
            border-radius: 15px;
            border: 1px solid var(--surface-light);
            padding: 20px;
            transition: all 0.3s;
        }

        .resource-category:hover {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
        }

        .category-title {
            font-size: 1.3em;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-count {
            background: var(--surface-light);
            padding: 5px 15px;
            border-radius: 20px;
            color: var(--text-dim);
            font-size: 0.9em;
        }

        .resource-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .resource-list::-webkit-scrollbar {
            width: 8px;
        }

        .resource-list::-webkit-scrollbar-track {
            background: var(--surface-light);
            border-radius: 4px;
        }

        .resource-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .resource-item {
            background: var(--surface-light);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border: 1px solid transparent;
            transition: all 0.3s;
        }

        .resource-item:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .resource-name {
            font-size: 1.1em;
            color: var(--text);
            margin-bottom: 5px;
            font-weight: bold;
        }

        .resource-description {
            color: var(--text-dim);
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .resource-path {
            color: var(--warning);
            font-size: 0.8em;
            font-family: monospace;
            margin-bottom: 10px;
            word-break: break-all;
        }

        .resource-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 20px;
            background: linear-gradient(135deg, var(--primary), #00A0CC);
            border: none;
            color: var(--background);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            font-weight: bold;
        }

        .action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 15px rgba(0, 212, 255, 0.5);
        }

        .terminal {
            background: #000;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            border: 1px solid var(--primary);
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
        }

        .terminal-header {
            color: var(--success);
            margin-bottom: 10px;
        }

        .terminal-output {
            color: var(--text);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: var(--primary);
        }

        .error {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .search-box {
            padding: 12px 20px;
            background: var(--surface);
            border: 1px solid var(--primary);
            color: var(--text);
            border-radius: 10px;
            font-family: inherit;
            font-size: 1em;
            width: 300px;
        }

        .search-box::placeholder {
            color: var(--text-dim);
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .filter-tab {
            padding: 10px 25px;
            background: var(--surface);
            border: 1px solid var(--surface-light);
            color: var(--text);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-tab.active {
            background: var(--primary);
            color: var(--background);
            border-color: var(--primary);
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 25px;
            background: var(--surface);
            border: 1px solid var(--primary);
            border-radius: 10px;
            color: var(--text);
            animation: slideIn 0.3s;
            z-index: 1000;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .collapsed .resource-list {
            display: none;
        }

        .category-toggle {
            color: var(--primary);
            font-size: 1.2em;
            transition: transform 0.3s;
        }

        .collapsed .category-toggle {
            transform: rotate(-90deg);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Jarvis Command Center V5</h1>
            <div class="subtitle">Complete Resource Control System</div>
            <div class="stats" id="stats">
                <div class="stat">
                    <div class="stat-value" id="total-count">0</div>
                    <div class="stat-label">Total Resources</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="skills-count">0</div>
                    <div class="stat-label">Skills</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="agents-count">0</div>
                    <div class="stat-label">Agents</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="workflows-count">0</div>
                    <div class="stat-label">Workflows</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="models-count">0</div>
                    <div class="stat-label">Models</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="scripts-count">0</div>
                    <div class="stat-label">Scripts</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <input type="text" class="search-box" id="search" placeholder="Search resources...">
            <button class="control-btn" onclick="refreshResources()">üîÑ Refresh All</button>
            <button class="control-btn" onclick="expandAll()">üìÇ Expand All</button>
            <button class="control-btn" onclick="collapseAll()">üìÅ Collapse All</button>
        </div>

        <div class="filter-tabs" id="filter-tabs">
            <div class="filter-tab active" onclick="filterResources('all')">All Resources</div>
            <div class="filter-tab" onclick="filterResources('skills')">Skills</div>
            <div class="filter-tab" onclick="filterResources('agents')">Agents</div>
            <div class="filter-tab" onclick="filterResources('workflows')">Workflows</div>
            <div class="filter-tab" onclick="filterResources('models')">Models</div>
            <div class="filter-tab" onclick="filterResources('scripts')">Scripts</div>
        </div>

        <div class="loading" id="loading">Loading all resources...</div>
        <div class="resource-grid" id="resource-grid" style="display: none;"></div>

        <div class="terminal" id="terminal">
            <div class="terminal-header">&gt; Terminal Output</div>
            <div class="terminal-output" id="terminal-output">Ready for execution...</div>
        </div>
    </div>

    <script>
        const API_BASE = '';
        let allResources = {};
        let currentFilter = 'all';

        // Load all resources on page load
        window.addEventListener('DOMContentLoaded', loadAllResources);

        // Search functionality
        document.getElementById('search').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            filterBySearch(query);
        });

        async function loadAllResources() {
            try {
                showLoading(true);

                // Fetch all resources from the comprehensive API
                const response = await fetch(`${API_BASE}/api/resources/all`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const data = await response.json();
                allResources = data.resources;

                // Update stats
                updateStats(data.counts);

                // Display all resources
                displayResources(allResources);

                showLoading(false);
                logTerminal('‚úÖ All resources loaded successfully');
            } catch (error) {
                console.error('Error loading resources:', error);
                showError(`Failed to load resources: ${error.message}`);
                showLoading(false);
                logTerminal(`‚ùå Error: ${error.message}`);
            }
        }

        function updateStats(counts) {
            document.getElementById('total-count').textContent = counts.total || 0;
            document.getElementById('skills-count').textContent = counts.skills || 0;
            document.getElementById('agents-count').textContent = counts.agents || 0;
            document.getElementById('workflows-count').textContent = counts.workflows || 0;
            document.getElementById('models-count').textContent = counts.models || 0;
            document.getElementById('scripts-count').textContent = counts.scripts || 0;
        }

        function displayResources(resources) {
            const grid = document.getElementById('resource-grid');
            grid.innerHTML = '';

            // Create categories for each resource type
            const categories = [
                { key: 'skills', title: 'üéØ Skills', icon: 'üéØ' },
                { key: 'agents', title: 'ü§ñ AI Agents', icon: 'ü§ñ' },
                { key: 'workflows', title: '‚ö° Workflows', icon: '‚ö°' },
                { key: 'models', title: 'üß† AI Models', icon: 'üß†' },
                { key: 'scripts', title: 'üìú Scripts', icon: 'üìú' }
            ];

            categories.forEach(category => {
                const items = resources[category.key] || [];
                if (items.length > 0 && (currentFilter === 'all' || currentFilter === category.key)) {
                    const categoryDiv = createCategoryDiv(category, items);
                    grid.appendChild(categoryDiv);
                }
            });

            grid.style.display = 'grid';
        }

        function createCategoryDiv(category, items) {
            const div = document.createElement('div');
            div.className = 'resource-category';
            div.dataset.category = category.key;

            div.innerHTML = `
                <div class="category-header" onclick="toggleCategory(this)">
                    <div class="category-title">
                        <span>${category.icon}</span>
                        <span>${category.title}</span>
                        <span class="category-toggle">‚ñº</span>
                    </div>
                    <div class="category-count">${items.length} items</div>
                </div>
                <div class="resource-list">
                    ${items.map(item => createResourceItem(item, category.key)).join('')}
                </div>
            `;

            return div;
        }

        function createResourceItem(item, type) {
            const name = item.name || item.title || 'Unnamed Resource';
            const description = item.description || 'No description available';
            const path = item.path || '';

            return `
                <div class="resource-item">
                    <div class="resource-name">${name}</div>
                    <div class="resource-description">${description}</div>
                    ${path ? `<div class="resource-path">üìÅ ${path}</div>` : ''}
                    <div class="resource-actions">
                        <button class="action-btn" onclick="executeResource('${type}', ${JSON.stringify(item).replace(/"/g, '&quot;')})">
                            ‚ñ∂Ô∏è Execute
                        </button>
                    </div>
                </div>
            `;
        }

        async function executeResource(type, resource) {
            try {
                logTerminal(`\nüöÄ Executing ${resource.name || resource.title}...`);
                showToast(`Executing ${resource.name || resource.title}...`);

                let endpoint = '';
                let body = {};

                switch(type) {
                    case 'skills':
                        endpoint = '/api/skills/execute';
                        body = {
                            skill_name: resource.name || resource.title,
                            path: resource.path,
                            parameters: {}
                        };
                        break;
                    case 'agents':
                        endpoint = '/api/agents/invoke';
                        body = {
                            agent_name: resource.name || resource.title,
                            task: `Execute ${resource.name || resource.title} agent`,
                            parameters: {}
                        };
                        break;
                    case 'workflows':
                        endpoint = `/api/workflows/start/${encodeURIComponent(resource.name || resource.title)}`;
                        body = { parameters: {} };
                        break;
                    case 'models':
                        endpoint = '/api/models/invoke';
                        body = {
                            model_id: resource.name || resource.title,
                            prompt: 'Test invocation',
                            parameters: {}
                        };
                        break;
                    case 'scripts':
                        endpoint = '/api/scripts/run';
                        body = {
                            script_path: resource.path,
                            arguments: []
                        };
                        break;
                }

                const response = await fetch(`${API_BASE}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                const result = await response.json();

                if (response.ok) {
                    logTerminal(`‚úÖ Success: ${result.output || result.message || 'Executed successfully'}`);
                    showToast(`‚úÖ ${resource.name || resource.title} executed successfully`);
                } else {
                    logTerminal(`‚ùå Error: ${result.detail || result.error || 'Execution failed'}`);
                    showToast(`‚ùå Failed to execute ${resource.name || resource.title}`);
                }
            } catch (error) {
                logTerminal(`‚ùå Error: ${error.message}`);
                showToast(`‚ùå Error executing resource`);
            }
        }

        function filterResources(filter) {
            currentFilter = filter;

            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Re-display with filter
            displayResources(allResources);
        }

        function filterBySearch(query) {
            if (!query) {
                displayResources(allResources);
                return;
            }

            const filtered = {};
            Object.keys(allResources).forEach(category => {
                filtered[category] = allResources[category].filter(item => {
                    const name = (item.name || item.title || '').toLowerCase();
                    const desc = (item.description || '').toLowerCase();
                    return name.includes(query) || desc.includes(query);
                });
            });

            displayResources(filtered);
        }

        async function refreshResources() {
            logTerminal('\nüîÑ Refreshing all resources...');
            showToast('üîÑ Refreshing resources...');

            try {
                // Call refresh endpoint
                await fetch(`${API_BASE}/api/resources/refresh`);
                // Reload all resources
                await loadAllResources();
                showToast('‚úÖ Resources refreshed');
            } catch (error) {
                logTerminal(`‚ùå Refresh failed: ${error.message}`);
                showToast('‚ùå Refresh failed');
            }
        }

        function toggleCategory(header) {
            const category = header.parentElement;
            category.classList.toggle('collapsed');
        }

        function expandAll() {
            document.querySelectorAll('.resource-category').forEach(cat => {
                cat.classList.remove('collapsed');
            });
        }

        function collapseAll() {
            document.querySelectorAll('.resource-category').forEach(cat => {
                cat.classList.add('collapsed');
            });
        }

        function logTerminal(message) {
            const output = document.getElementById('terminal-output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `\n[${timestamp}] ${message}`;
            output.scrollTop = output.scrollHeight;
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
            document.getElementById('resource-grid').style.display = show ? 'none' : 'grid';
        }

        function showError(message) {
            const grid = document.getElementById('resource-grid');
            grid.innerHTML = `<div class="error">${message}</div>`;
            grid.style.display = 'block';
        }
    </script>
</body>
</html>